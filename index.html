<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ¯ç‡æ¯æ—¥ç›£æ§è¡¨</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: #fff; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; }
        h2 { text-align: center; color: #333; margin-bottom: 10px; }
        .status { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 20px; }
        
        /* ç¯©é¸å™¨æ¨£å¼ */
        .filter-box {
            background-color: #eafaf1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            align-items: center;
        }
        .filter-box select { padding: 8px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; }
        .filter-box label { font-weight: bold; color: #444; }

        /* --- è¡¨æ ¼å€å¡Šæ¨£å¼ (æœ¬æ¬¡ä¿®æ”¹é‡é») --- */
        .table-wrapper { 
            /* 1. è¨­å®šæœ€å¤§é«˜åº¦ï¼Œè®“è³‡æ–™å¤ªé•·æ™‚å‡ºç¾å·è»¸ */
            max-height: 70vh; /* ä½”æ“šè¦–çª—é«˜åº¦çš„ 70% */
            overflow-y: auto; /* å…è¨±å‚ç›´æ»¾å‹• */
            overflow-x: auto; /* å…è¨±æ°´å¹³æ»¾å‹• (æ‰‹æ©Ÿç‰ˆ) */
            border: 1px solid #ddd; /* åŠ å€‹å¤–æ¡†æ¯”è¼ƒå¥½çœ‹ */
        }

        table { 
            width: 100%; 
            border-collapse: separate; /* ç‚ºäº†é…åˆ stickyï¼Œæ”¹ç”¨ separate (é‚Šæ¡†åˆ†é›¢) */
            border-spacing: 0; /* ä½†æŠŠé–“è·è¨­ç‚º 0ï¼Œçœ‹èµ·ä¾†é‚„æ˜¯åƒé€£åœ¨ä¸€èµ· */
            font-size: 14px; 
        }

        th, td { 
            border-bottom: 1px solid #ddd; /* æ”¹æˆåªç•«åº•ç·š */
            border-right: 1px solid #ddd; /* åŠ å³ç·š */
            padding: 10px; 
            text-align: center; 
        }
        
        /* å·¦å´ç¬¬ä¸€æ¬„ (æ—¥æœŸ) ä¹ŸåŠ å·¦ç·š */
        th:first-child, td:first-child { border-left: 1px solid #ddd; }

        /* --- å‡çµæ¨™é¡Œ (Sticky Header) --- */
        th { 
            background-color: #6a9e6f; 
            color: white; 
            white-space: nowrap; 
            
            /* é­”æ³•æŒ‡ä»¤ï¼šé»åœ¨é ‚éƒ¨ */
            position: sticky; 
            top: 0; 
            z-index: 10; /* ç¢ºä¿æµ®åœ¨è³‡æ–™ä¸Šé¢ */
            
            /* åŠ ä¸€é»é™°å½±ï¼Œè®“æ¨™é¡Œçœ‹èµ·ä¾†æµ®èµ·ä¾† */
            box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.2); 
            border-top: 1px solid #6a9e6f; /* ä¿®é£¾é ‚éƒ¨é‚Šæ¡† */
        }

        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #d1f2eb; }
        td:first-child { font-weight: bold; color: #444; }
        
        .no-data { text-align: center; color: red; padding: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ˆ æ¯æ—¥åŒ¯ç‡è‡ªå‹•è¿½è¹¤è¡¨</h2>
    <div class="status">è³‡æ–™ä¾†æºï¼šdata.json (æ¯æ—¥ 10:00 è‡ªå‹•æ›´æ–°ï¼Œé‡å‡æ—¥è‡ªå‹•é †å»¶)</div>

    <div class="filter-box">
        <div>
            <label for="yearFilter">å¹´ä»½ï¼š</label>
            <select id="yearFilter">
                <option value="all">å…¨éƒ¨å¹´ä»½</option>
            </select>
        </div>
        <div>
            <label for="monthFilter">æœˆä»½ï¼š</label>
            <select id="monthFilter">
                <option value="all">å…¨éƒ¨æœˆä»½</option>
                <option value="01">01æœˆ</option>
                <option value="02">02æœˆ</option>
                <option value="03">03æœˆ</option>
                <option value="04">04æœˆ</option>
                <option value="05">05æœˆ</option>
                <option value="06">06æœˆ</option>
                <option value="07">07æœˆ</option>
                <option value="08">08æœˆ</option>
                <option value="09">09æœˆ</option>
                <option value="10">10æœˆ</option>
                <option value="11">11æœˆ</option>
                <option value="12">12æœˆ</option>
            </select>
        </div>
    </div>
    
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th>
                    <th>é™½ä¿¡USDè²·å…¥</th>
                    <th>é™½ä¿¡USDè³£å‡º</th>
                    <th>é™½ä¿¡CNYè²·å…¥</th>
                    <th>é™½ä¿¡CNYè³£å‡º</th>
                    <th>å°éŠ€USDè²·å…¥</th>
                    <th>å°éŠ€USDè³£å‡º</th>
                    <th>å°éŠ€CNYè²·å…¥</th>
                    <th>å°éŠ€CNYè³£å‡º</th>
                </tr>
            </thead>
            <tbody id="rate-data">
                <tr><td colspan="9">æ­£åœ¨è®€å–é›²ç«¯è³‡æ–™...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    let allData = [];

    document.addEventListener("DOMContentLoaded", function() {
        fetch('data.json?' + new Date().getTime())
            .then(response => response.json())
            .then(data => {
                // å¦‚æœåŸå§‹è³‡æ–™æ˜¯èˆŠåœ¨ä¸Šé¢ï¼Œé€™è£¡è¦ reverse è®Šæˆæ–°åœ¨ä¸Šé¢
                // å¦‚æœä½ çš„ data.json å·²ç¶“æ‰‹å‹•æ•´ç†éé †åºï¼Œè«‹ç¢ºèªé¡¯ç¤ºæ˜¯å¦æ­£ç¢º
                // é€™è£¡å‡è¨­æˆ‘å€‘è¦æŠŠæ—¥æœŸæœ€æ–°çš„é¡¯ç¤ºåœ¨æœ€ä¸Šé¢
                
                // ç°¡æ˜“åˆ¤æ–·ï¼šå¦‚æœç¬¬ä¸€ç­†è³‡æ–™æ—¥æœŸæ¯”æœ€å¾Œä¸€ç­†èˆŠï¼Œä»£è¡¨æ˜¯ã€ŒèˆŠ->æ–°ã€æ’åºï¼Œæˆ‘å€‘å°±åè½‰å®ƒ
                if(data.length > 1) {
                    let firstDate = new Date(data[0].date);
                    let lastDate = new Date(data[data.length-1].date);
                    if(firstDate < lastDate) {
                        data.reverse();
                    }
                }
                
                allData = data;
                initFilters();
                renderTable(allData);
            })
            .catch(err => {
                document.getElementById('rate-data').innerHTML = "<tr><td colspan='9' style='color:red;'>ç„¡æ³•è®€å– data.jsonï¼Œè«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚</td></tr>";
            });
        
        document.getElementById('yearFilter').addEventListener('change', filterData);
        document.getElementById('monthFilter').addEventListener('change', filterData);
    });

    function initFilters() {
        const yearFilter = document.getElementById('yearFilter');
        const years = [...new Set(allData.map(item => item.date.split('-')[0]))];
        // å¹´ä»½ä¹Ÿæ’åºä¸€ä¸‹ï¼Œè®“è¿‘çš„å¹´ä»½åœ¨ä¸Šé¢
        years.sort().reverse().forEach(year => {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year + "å¹´";
            yearFilter.appendChild(option);
        });
    }

    function filterData() {
        const selectedYear = document.getElementById('yearFilter').value;
        const selectedMonth = document.getElementById('monthFilter').value;

        const filtered = allData.filter(item => {
            const [year, month, day] = item.date.split('-');
            const yearMatch = (selectedYear === 'all') || (year === selectedYear);
            const monthMatch = (selectedMonth === 'all') || (month === selectedMonth);
            return yearMatch && monthMatch;
        });

        renderTable(filtered);
    }

    function renderTable(data) {
        const tableBody = document.getElementById('rate-data');
        tableBody.innerHTML = "";

        if (data.length === 0) {
            tableBody.innerHTML = "<tr><td colspan='9' class='no-data'>âš ï¸ æŸ¥ç„¡æ­¤å€é–“çš„è³‡æ–™</td></tr>";
            return;
        }

        data.forEach(row => {
            const tr = document.createElement('tr');
            [row.date, row.sunny_usd_buy, row.sunny_usd_sell, row.sunny_cny_buy, row.sunny_cny_sell,
             row.bot_usd_buy, row.bot_usd_sell, row.bot_cny_buy, row.bot_cny_sell].forEach(text => {
                const td = document.createElement('td');
                td.textContent = text;
                tr.appendChild(td);
            });
            tableBody.appendChild(tr);
        });
    }
</script>

</body>
</html>
